<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!-- Define your QWeb report template here -->
        <template id="report_leave_encash">
            <t t-set="company" t-value="env.company"/>
            <t t-call="web.html_container">
                <t t-call="web.internal_layout">
                    <div class="page">
                        <div class="text-center">
                            <h3>Leave Encashment</h3>
                        </div>
                        <table  class="table table-sm">
                            <thead>
                                <tr>
                                    <th>From Date</th>
                                    <th>To Date</th>
                                    <th>No. of Employees</th>
                                    <th>Total Amount</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>
                                        <t t-if="form_data['date_start']">
                                            <strong><t t-esc="form_data['date_start']" t-options="{'widget': 'datetime'}"/></strong>
                                        </t>
                                    </td>
                                    <td>
                                        <t t-if="date_end">
                                            <strong><t t-esc="date_end" t-options="{'widget': 'datetime'}"/></strong>
                                        </t>
                                    </td>
                                    <td><strong><t t-esc="total_employees" /></strong></td>
                                    <td><strong><t t-esc="amount_total" /></strong></td>
                                </tr>
                            </tbody>
                        </table>
                        <t t-if="report_filter == 'by_employee'">
                            <table  class="table table-condensed">
                                <thead>
                                    <tr>
                                        <th>Ref. No.</th>
                                        <th>Leave Type</th>
                                        <th>Quantity</th>
                                        <th>Amount</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <t t-foreach="employees" t-as="e">
                                        <t t-set="emptotal" t-value="0"/>
                                        <tr>
                                            <td colspan="4"><h4><span t-esc="e['employee_name']"/></h4></td>
                                        </tr>
                                        <tr t-foreach="leave_encash_ids" t-as="le">
                                            <t t-if="le['employee_id'] == e['employee_id']">
                                                <t t-set="emptotal" t-value="emptotal + le['amount_total']"/>
                                                <td><span t-esc="le['name']"/></td>
                                                <td><span t-esc="le['holiday_status_name']"/></td>
                                                <td class="text-center"><span t-esc="le['number_of_leaves']"/>/<span t-esc="le['leave_type_request_unit']"/></td>
                                                <td class="text-right"><span t-esc="le['amount_total']" /></td>
                                                <td class="text-center"><span t-esc="le['state']" /></td>
                                            </t>
                                        </tr>
                                        <tr>
                                            <td colspan="3" class="text-left"><strong>Total</strong></td>
                                            <td class="text-right"><strong><t t-esc="emptotal"/></strong></td>
                                            <td/>
                                        </tr>
                                    </t>
                                </tbody>
                            </table>
                        </t>
                        <t t-if="report_filter == 'by_leave_type'">
                            <table  class="table table-condensed">
                                <thead>
                                    <tr>
                                        <th>Ref. No.</th>
                                        <th>Employee</th>
                                        <th>Quantity</th>
                                        <th>Amount</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <t t-foreach="leave_types" t-as="lt">
                                        <t t-set="lttotal" t-value="0"/>
                                        <tr>
                                            <td colspan="4"><h4><span t-esc="lt['leave_type_name']"/></h4></td>
                                        </tr>
                                        <tr t-foreach="leave_encash_ids" t-as="le">
                                            <t t-if="le['holiday_status_id'] == lt['leave_type_id']">
                                                <t t-set="lttotal" t-value="lttotal + le['amount_total']"/>
                                                <td><span t-esc="le['name']"/></td>
                                                <td><span t-esc="le['holiday_status_name']"/></td>
                                                <td class="text-center"><span t-esc="le['number_of_leaves']"/>/<span t-esc="le['leave_type_request_unit']"/></td>
                                                <td class="text-right"><span t-esc="le['amount_total']" /></td>
                                                <td class="text-center"><span t-esc="le['state']" /></td>
                                            </t>
                                        </tr>
                                        <tr>
                                            <td colspan="3" class="text-left"><strong>Total</strong></td>
                                            <td class="text-right"><strong><t t-esc="lttotal"/></strong></td>
                                            <td/>
                                        </tr>
                                    </t>
                                </tbody>
                            </table>
                        </t>
                    </div>
                </t>
            </t>
        </template>
    </data>
</odoo>
