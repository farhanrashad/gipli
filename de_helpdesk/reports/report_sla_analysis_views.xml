<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <record id="report_project_ticket_sla_search_view" model="ir.ui.view">
        <field name="name">report.project.ticket.sla.analysis.search.view</field>
        <field name="model">report.project.ticket.sla.analysis</field>
        <field name="arch" type="xml">
            <search string="SLA Analysis Search">
                <field name="team_id" string="Helpdesk Team"/>
                <field name="ticket_id" string="Ticket" />
<!--
                <filter string="My Tickets" domain="[('task_id.user_ids','in',uid)]" name="my_tickets"/>
                <filter string="Unassigned" domain="[('task_id.user_ids','=',False)]" name="unassigned"/>
                <separator/>
                <filter string="SLA Success" domain="[('status','=','reached')]" name="sla_success"/>
                <filter string="SLA In Progress" domain="[('status','=','ongoing')]" name="sla_ongoing"/>
                <filter string="SLA Failed" domain="[('status','=','failed')]" name="sla_failed"/>
                
                <separator/>
                <filter string="Today" name="rating_today" domain="[
                    ('create_date','&gt;', (context_today() - datetime.timedelta(days=0)).strftime('%%Y-%%m-%%d'))
                ]"  />
                <filter string="Last 7 Days" name="rating_last_7_days" domain="[
                    ('create_date','&gt;', (context_today() - datetime.timedelta(days=7)).strftime('%%Y-%%m-%%d'))
                ]"  />
                <filter string="Last 30 Days" name="rating_last_30_days" domain="[
                    ('create_date','&gt;', (context_today() - datetime.timedelta(days=30)).strftime('%%Y-%%m-%%d'))
                ]"  />
                <group expand="0" string="Group By">
                    <filter string="Assignees" name="user" context="{'group_by': 'task_id.user_ids'}"/>
                    <filter string="Customer" name="customer" context="{'group_by': 'task_id.partner_id'}"/>
                    <filter string="Team" name="helpdesk_team" context="{'group_by': 'project_id'}"/>
                    <filter string="Status" name="status" context="{'group_by': 'status'}"/>
                </group>
                -->
            </search>
        </field>
    </record>

    <record id="report_project_ticket_sla_analysis_pivot" model="ir.ui.view">
        <field name="name">report.project.ticket.sla.analysis.pivot</field>
        <field name="model">report.project.ticket.sla.analysis</field>
        <field name="arch" type="xml">
        <pivot string="SLA Status Analysis" disable_linking="1" sample="1">
            <field name="team_id" string="Team" type="row"/>
            <field name="sla_id" type="row"/>
            <field name="sla_status_failed"/>
            <field name="sla_status" type="col"/>
            <field name="close_ticket_hours" widget="float_time"/>
            <field name="rating_avg" type="measure" invisible="1"/>
         </pivot>
     </field>
    </record>

    <record id="report_project_ticket_sla_analysis_graph" model="ir.ui.view">
        <field name="name">report.project.ticket.sla.analysis.graph</field>
        <field name="model">report.project.ticket.sla.analysis</field>
        <field name="arch" type="xml">
            <graph string="SLA Status Analysis" disable_linking="1" sample="1">
                 <field name="sla_id"/>
                 <field name="sla_status"/>
                 <!-- Remove me in master -->
                 <field name="sla_status_failed" invisible="1"/>
             </graph>
         </field>
    </record>
    
    <record id="report_project_ticket_sla_analysis_cohort" model="ir.ui.view">
        <field name="name">report.project.ticket.sla.analysis.cohort</field>
        <field name="model">report.project.ticket.sla.analysis</field>
        <field name="arch" type="xml">
            <cohort string="Tickets Analysis" date_start="create_date" date_stop="close_date" disable_linking="True" interval="day" sample="1" measure="open_ticket_hours">
                <field name="rating_avg" invisible="1"/>
            </cohort>
        </field>
    </record>
    
    <!-- Pivot view -->
    <record id="action_report_sla_analysis" model="ir.actions.act_window">
        <field name="name">SLA Analysis</field>
        <field name="res_model">report.project.ticket.sla.analysis</field>
        <field name="view_mode">pivot,graph,cohort</field>
        <field name="search_view_id" ref="report_project_ticket_sla_search_view"/>
    </record>

    <menuitem name="SLA Analysis" id="menu_helpdesk_reports_sla_analysis"
            parent="menu_helpdesk_reports" 
            action="action_report_sla_analysis"
            sequence="20"
        />
</odoo>