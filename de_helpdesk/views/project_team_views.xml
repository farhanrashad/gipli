<odoo>
  <data>
    <record id="edit_project_inherit" model="ir.ui.view">
        <field name="name">iedit.project.inherit</field>
        <field name="model">project.project</field>
        <field name="inherit_id" ref="project.edit_project"/>
        <field name="arch" type="xml">
            <!-- hide origional fields -->
            <xpath expr="//header" position="inside">
              <field name="is_helpdesk_team" invisible="1"/>
            </xpath>

            <xpath expr="//header/button" position="attributes">
                <attribute name="attrs">{'invisible':[('is_helpdesk_team','=',True)]}</attribute>
            </xpath>
            <xpath expr="//div[hasclass('oe_chatter')]" position="attributes">
                <attribute name="attrs">{'invisible':[('is_helpdesk_team','=',True)]}</attribute>
            </xpath>
            
            <xpath expr="//div[hasclass('oe_title')]" position="replace">
                <div class="oe_title" attrs="{'invisible': [('is_helpdesk_team','=',True)]}" >
                    <h1 class="d-flex flex-row">
                        <field name="is_favorite" nolabel="1" widget="boolean_favorite" class="me-2"/>
                        <field name="name" options="{'line_breaks': False}" widget="text" class="o_text_overflow" placeholder="e.g. Office Party"/>
                    </h1>
                </div>
                <div class="oe_title" attrs="{'invisible': [('is_helpdesk_team','!=',True)]}">
                    <label for="name" string="Name"/>
                    <h1 id="name"><field name="name" options="{'line_breaks': False}" widget="text" placeholder="e.g. Customer Care"/></h1>
                </div>
                
                <field name="company_id" 
                    attrs="{'invisible': [('is_helpdesk_team','!=',True)]}"
                    groups="base.group_multi_company" 
                    required="1" 
                    nolabel="1" 
                    context="{'create': False}"
                />
            </xpath>
              
            <xpath expr="//group[1]" position="attributes">
                <attribute name="attrs">{'invisible':[('is_helpdesk_team','=',True)]}</attribute>
            </xpath>
            <xpath expr="//page[@name='settings']" position="attributes">
                <attribute name="attrs">{'invisible':[('is_helpdesk_team','=',True)]}</attribute>
            </xpath>
            <xpath expr="//page[@name='description']" position="attributes">
               <attribute name="attrs">{'invisible':[('is_helpdesk_team','=',True)]}</attribute>
            </xpath>

            <xpath expr="//button[@name='project_update_all_action']" position="attributes">
                <attribute name="attrs">{'invisible':[('is_helpdesk_team','=',True)]}</attribute>
            </xpath>
            <xpath expr="//div[hasclass('oe_button_box')]//button[2]" position="attributes">
                <attribute name="attrs">{'invisible':[('is_helpdesk_team','=',True)]}</attribute>
            </xpath>
            <xpath expr="//button[3]" position="attributes">
                <attribute name="attrs">{'invisible':[('is_helpdesk_team','=',True)]}</attribute>
            </xpath>
            
            <!-- Add helpdesk sections -->
            <xpath expr="//div[hasclass('oe_button_box')]/button[1]" position="before">
                    <button name="action_open_tickets_view" 
                        type="object" 
                        icon="fa-life-ring" 
                        class="oe_stat_button"
                        attrs="{'invisible':[('is_helpdesk_team','!=',True)]}"
                    >
                            <field string="Tickets" name="task_count" widget="statinfo"/>
                    </button>
                        <field name="count_tickets_rating" invisible="1"/>
                        <field name="tickets_avg_rating" invisible="1"/>
                        <button name="action_open_tickets_rating_view" type="object" class="oe_stat_button" 
                            icon="" attrs="{'invisible': ['|',('allow_customer_rating','!=',True),('count_tickets_rating','=',0)]}"
                            title="Average Rating">
                            <i class="fa fa-fw o_button_icon fa-smile-o text-success" 
                                attrs="{'invisible':[('tickets_avg_rating','&lt;',3.66)]}" title="Satisfied"/>
                            <i class="fa fa-fw o_button_icon fa-meh-o text-warning" 
                                attrs="{'invisible': ['|',('tickets_avg_rating','&lt;',2.33),('tickets_avg_rating','&gt;=', 3.66)]}" title="Okay"/>
                            <i class="fa fa-fw o_button_icon fa-frown-o text-danger" attrs="{'invisible':[('tickets_avg_rating','&gt;=',2.33)]}" title="Dissatisfied"/>
                            <div class="o_field_widget o_stat_info">
                                <span class="o_stat_value">
                                    <field name="tickets_avg_rating" nolabel="1" widget="float" digits="[1, 1]"/> / 5 for <field name="count_tickets_rating" />
                                </span>
                                <span class="o_stat_text">
                                    Avg. Rating
                                </span>
                            </div>
                        </button>
                        <button name="action_open_tickets_sla_view" type="object" icon="fa-calendar-check-o" class="oe_stat_button" attrs="{'invisible': [('is_sla','!=',True)]}">
                            <field name="count_sla" string="SLA Policies" widget="statinfo"/>
                        </button>
            </xpath>
            <xpath expr="//notebook" position="inside">
            <page string="Description" name="helpdesk_team_description" attrs="{'invisible': [('is_helpdesk_team','!=',True)]}">
                <field name="description" 
                    attrs="{'invisible': [('is_helpdesk_team','!=',True)]}"
                    placeholder="Describe your team to your colleagues and customers..."
                    options="{'escape': True}"
                    style="min-height:50px !important;height:50px !important;"
                />
            </page>
            <page string="Settings" name="helpdesk_team_settings" attrs="{'invisible': [('is_helpdesk_team','!=',True)]}">
                <div class="row mt16 o_settings_container" name="helpdesk_team_setting_container" attrs="{'invisible': [('is_helpdesk_team','!=',True)]}">
                    <h2>Visibility &amp; Assignment </h2>
                    <div id="helpdesk_team_settings_visibility" class="col-12 col-lg-5 o_setting_box" title="People to whom this team and its tickets will be visible.">
                        <div class="o_setting_right_pane">
                            <label for="privacy_visibility"/>
                            <div class="text-muted">
                                People to whom this team and its tickets will be visible.
                            </div>
                            <div class="content-group">
                                <div class="mt16">
                                    <field name="privacy_visibility" class="mt16 o_light_label" widget="radio"/>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="helpdesk_team_settings_followers" class="col-12 col-lg-5 offset-lg-1 o_setting_box" title="Receive notifications whenever tickets are created, rated or discussed on in this team.">
                        <div class="o_setting_right_pane">
                            <label for="message_partner_ids"/>
                            <div class="text-muted">
                                Receive notifications whenever tickets are created, rated or discussed on in this team
                            </div>
                            <div class="content-group">
                                <div class="mt16">
                                    <field name="message_partner_ids" string="Followers" widget="many2many_tags_email"/>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                    <!-- automation -->
                <div class="row mt16 o_settings_container" name="helpdesk_team_automation_setting_container" attrs="{'invisible': [('is_helpdesk_team','!=',True)]}">
                    <h2>Automation</h2>
                    <div id="helpdesk_team_settings_automation" class="col-12 col-lg-5 o_setting_box" title="Automate the assignment of new tickets to the right people, and make sure all tickets are being handled.">
                        <div class="o_setting_left_pane">
                            <field name="auto_assignment"/>
                        </div>
                        <div class="o_setting_right_pane" >
                            <label for="assign_method"/>
                            <div class="text-muted">
                                Automate the assignment of new tickets to the right people, and make sure all tickets are being handled.
                            </div>
                            <div class="content-group" attrs="{'invisible': [('auto_assignment','!=',True)]}">
                                <div class="mt16">
                                    <field name="assign_method" class="o_light_label w-100" widget="radio"/>
                                    <field name="team_member_ids" 
                                        options="{'no_create':True,'no_edit':True}"
                                        widget="many2many_tags"
                                        attrs="{'invisible': [('auto_assignment','!=',True)]}"
                                    />
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="helpdesk_team_settings_automation_ticket_approvals" class="col-12 col-lg-5 offset-lg-1 o_setting_box" title="Set approval for tickets: By security groups (pre-defined teams) or by individual Users.">
                        <div class="o_setting_left_pane">
                            <field name="is_ticket_approvals"/>
                        </div>
                        <div class="o_setting_right_pane" >
                            <label for="ticket_approval_type"/>
                            <div class="text-muted">
                                Set approval for tickets: By security groups (pre-defined teams) or by individual Users.
                            </div>
                            <div class="content-group" attrs="{'invisible': [('is_ticket_approvals','!=',True)]}">
                                <div class="mt16">
                                    <field name="ticket_approval_type" 
                                        attrs="{'required':[('is_ticket_approvals','=',True)]}"
                                        class="o_light_label w-100" 
                                        widget="radio"
                                    />
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="helpdesk_team_settings_automation_merge_tickets" class="col-12 col-lg-5 o_setting_box" title="Allow users to combine related tickets into one for a more streamlined resolution.">
                        <div class="o_setting_left_pane">
                            <field name="is_merge_tickets"/>
                        </div>
                        <div class="o_setting_right_pane" >
                            <div class="text-muted">
                                <strong>Merge Tickets</strong>
                                Allow users to combine related tickets into one for a more streamlined resolution.
                            </div>
                            <field name="is_history_tickets" invisible="1"/>
                        </div>
                    </div>
                    <div id="helpdesk_team_settings_automation_auto_close_tickets" class="col-12 col-lg-5 o_setting_box" title="Close inactive tickets automatically.">
                        <div class="o_setting_left_pane">
                            <field name="allow_ticket_auto_close"/>
                        </div>
                        <div class="o_setting_right_pane" >
                            <div class="text-muted">
                                Close inactive tickets automatically.
                            </div>
                            <div class="content-group" attrs="{'invisible': [('allow_ticket_auto_close','!=',True)]}" >
                                <div class="mt16">
                                    <label for="close_stage_id"/>
                                    <field name="close_stage_id" class="ms-2 oe_inline" attrs="{'required': [('allow_ticket_auto_close','=',True)]}" context="{'default_project_id': id}"/>
                                </div>
                                <div class="mt8">
                                    <strong>After</strong><field name="day_to_close" class="mx-2 oe_inline text-center" required="1"/><span>days of inactivity</span>
                                </div>
                                <div class="mt8">
                                    <label for="from_stage_ids"/>
                                    <field name="from_stage_ids" widget="many2many_tags" class="ms-2" context="{'default_project_id': id}"/>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="helpdesk_team_settings_automation_reopen_tickets" class="col-12 col-lg-5 o_setting_box" title="Allow users to reopen tickets for a more streamlined resolution.">
                        <div class="o_setting_left_pane">
                            <field name="is_reopen_tickets"/>
                        </div>
                        <div class="o_setting_right_pane" >
                            <div class="text-muted">
                                <strong>Re-open Tickets</strong>
                                Allow users to reopen tickets for a more streamlined resolution.
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row mt16 o_settings_container" name="helpdesk_team_channels_setting_container" attrs="{'invisible': [('is_helpdesk_team','!=',True)]}">
                    <h2>Channels</h2>
                    <div id="helpdesk_team_settings_channels" class="col-12 col-lg-5 o_setting_box" title="Create tickets by sending an email to an alias.">
                        <div class="o_setting_right_pane" >
                            <div class="text-muted">
                                Create tickets by sending an email to an alias.
                            </div>
                            <div class="content-group" >
                                <strong>Alias </strong><br/>
                                <field name="alias_name" class="w-25"/>@
                                <field name="alias_domain" class="oe_inline" placeholder="e.g. domain.com"
                                    options="{'no_create': True, 'no_open': True}"/>

                                <p attrs="{'invisible':[('alias_domain','=',True)]}">
                                    <button name="%(base_setup.action_general_configuration)d" type="action" string="Set an Alias Domain" icon="fa-arrow-right" class="btn-link mt-2"/>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Help Center -->
                <div class="row mt16 o_settings_container" name="helpdesk_team_help_setting_container" attrs="{'invisible': [('is_helpdesk_team','!=',True)]}">
                    <h2>Help Center</h2>
                    <div id="helpdesk_team_settings_help_web" class="col-12 col-lg-5 o_setting_box" title="Get tickets through an online form.">
                        <div class="o_setting_left_pane">
                            <field name="allow_submit_ticket_from_web"/>
                        </div>
                        <div class="o_setting_right_pane" >
                            <div class="text-muted">
                                <strong>Web Form</strong><br/>
                                Get tickets through an online form.
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Track Bills -->
                <div class="row mt16 o_settings_container" name="helpdesk_team_timesheet_setting_container" attrs="{'invisible': [('is_helpdesk_team','!=',True)]}">
                    <h2>Track Bill and Time</h2>
                    <div id="helpdesk_team_settings_timesheet_hr" class="col-12 col-lg-5 o_setting_box" title="Track the employee time spent on tickets.">
                        <div class="o_setting_left_pane">
                            <field name="module_hr_timesheet"/>
                        </div>
                        <div class="o_setting_right_pane" >
                            <div class="text-muted">
                                Track the employee time spent on tickets.
                            </div>
                        </div>
                    </div>

                    <div id="helpdesk_team_settings_timesheet_sale" class="col-12 col-lg-5 o_setting_box" title="Bill the time spent on your tickets to your customers.">
                        <div class="o_setting_left_pane">
                            <field name="module_sale_timesheet"/>
                        </div>
                        <div class="o_setting_right_pane" >
                            <div class="text-muted">
                                Bill the time spent on your tickets to your customers.
                            </div>
                        </div>
                    </div>
                    
                </div>
                <!-- SLA Policies -->
                <div class="row mt16 o_settings_container" name="helpdesk_team_sla_setting_container" attrs="{'invisible': [('is_helpdesk_team','!=',True)]}">
                    <h2>SLA Policies and Customer Rating</h2>
                    <div id="helpdesk_team_settings_sla" class="col-12 col-lg-5 o_setting_box" title="Make sure tickets are handled on time.">
                        <div class="o_setting_left_pane">
                            <field name="is_sla"/>
                        </div>
                        <div class="o_setting_right_pane" >
                            <div class="text-muted">
                                <h6>SLA Policies</h6>
                                Make sure tickets are handled on time.
                            </div>
                            <div class="content-group" >
                                
                            </div>
                        </div>
                    </div>

                    <div id="helpdesk_team_settings_rating" class="col-12 col-lg-5 o_setting_box" title="Track customer satisfaction on tickets.">
                        <div class="o_setting_left_pane">
                            <field name="allow_customer_rating"/>
                        </div>
                        <div class="o_setting_right_pane" >
                            <div class="text-muted">
                                <h6>Customer Ratings</h6>
                                Track customer satisfaction on tickets.
                            </div>
                            <div class="content-group" attrs="{'invisible': [('allow_customer_rating','!=',True)]}">
                                <field name="publish_rating" class="oe_inline"/>
                                <label for="publish_rating" string="Publish this team's ratings on your website"/>
                            </div>
                            <div class="text-muted">
                                Set an Email Template on Stages
                            </div>
                            <div class="content-group" attrs="{'invisible': [('allow_customer_rating','!=',True)]}">
                                <button name="%(action_ticket_stage)d" type="action" string="Set an Email Template on Stages" icon="fa-arrow-right" class="btn-link" context="{'search_default_team_ids': name}"/>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Self Service -->
                <div class="row mt16 o_settings_container" name="helpdesk_team_service_setting_container" attrs="{'invisible': [('is_helpdesk_team','!=',True)]}">
                    <h2>Self Service</h2>
                    <div id="helpdesk_team_settings_service_close" class="col-12 col-lg-5 o_setting_box" title="Allow customers to easily close their tickets through the portal for quick resolutions.">
                        <div class="o_setting_left_pane">
                            <field name="allow_portal_user_close_ticket"/>
                        </div>
                        <div class="o_setting_right_pane" >
                            <div class="text-muted">
                                <h6>Close tickets</h6>
                                Allow customers to easily close their tickets through the portal for quick resolutions.
                            </div>
                            <div class="content-group" attrs="{'invisible': [('allow_portal_user_close_ticket','!=',True)]}" >
                               <label for="portal_close_stage_id"/>
                                <field name="portal_close_stage_id" 
                                            class="ms-2 oe_inline" 
                                            attrs="{'required': [('allow_portal_user_close_ticket','=',True)],'invisible':[('allow_portal_user_close_ticket','!=',True)]}" 
                                            context="{'default_project_id': id}"
                                            
                                /> 
                            </div>
                        </div>
                    </div>
                    <div id="helpdesk_team_settings_service_open" class="col-12 col-lg-5 o_setting_box" title="Allow customers to conveniently reopen their tickets through the portal for further assistance.">
                        <div class="o_setting_left_pane">
                            <field name="allow_portal_user_reopen_ticket"/>
                        </div>
                        <div class="o_setting_right_pane" >
                            <div class="text-muted">
                                <h6>Re-Open tickets</h6>
                                Allow customers to conveniently reopen their tickets through the portal for further assistance.
                            </div>
                        </div>
                    </div>
                </div>
            </page>
            </xpath>

            
            
        </field>
      </record>

      
      <record id="helpdesk_team_search_view" model="ir.ui.view">
        <field name="name">helpdesk.team.search.view</field>
        <field name="model">project.project</field>
        <field name="arch" type="xml">
            <search string="Helpdesk Team Search">
                <field name="name"/>
                <field name="company_id" groups="base.group_multi_company"/>
                <separator/>
                <filter string="Archived" domain="[('active', '=', False)]" name="archived"/>
                <group expand="0" string="Group By">
                    <filter string="Company" name="company" context="{'group_by': 'company_id'}" groups="base.group_multi_company"/>
                </group>
            </search>
        </field>
    </record>
      
      
    <record id="helpdesk_team_tree_view" model="ir.ui.view">
        <field name="name">helpdesk.team.tree.view</field>
        <field name="model">project.project</field>
        <field name="arch" type="xml">
            <tree string="Helpdesk Team" multi_edit="1" sample="1">
                <field name="sequence" widget="handle"/>
                <field name="name" class="field_name" string="Name"/>
                <field name="alias_value" string="Email Alias" widget="email" readonly="1" />
                <field name="company_id" groups="base.group_multi_company" readonly="1" context="{'create': False}"/>
            </tree>
        </field>
    </record>

      <record id="open_view_project_helpdesk_config" model="ir.actions.act_window">
            <field name="name">Projects</field>
            <field name="res_model">project.project</field>
            <field name="domain">[]</field>
            <field name="view_mode">tree,kanban,form</field>
            <field name="view_ids" eval="[(5, 0, 0),
                (0, 0, {'view_mode': 'tree', 'view_id': ref('helpdesk_team_tree_view')}),
                (0, 0, {'view_mode': 'kanban', 'view_id': ref('project.view_project_config_kanban')})]"/>
            <field name="search_view_id" ref="helpdesk_team_search_view"/>
            <field name="domain">[
                ('is_helpdesk_team', '=', True),
                ]
            </field>
            <field name="context">{
                'default_is_helpdesk_team': True
                }
            </field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                   No projects found. Let's create one!
                </p>
                <p>
                    Create projects to organize your tasks and define a different workflow for each project.
                </p>
            </field>
        </record>
      
    <menuitem name="Helpdesk Teams" id="menu_helpdesk_config_teams"
            parent="menu_helpdesk_config" 
            action="open_view_project_helpdesk_config"
            sequence="20"
        />
  </data>
</odoo>
