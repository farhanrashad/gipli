<odoo>
  <data>
    <record id="edit_project_inherit" model="ir.ui.view">
        <field name="name">iedit.project.inherit</field>
        <field name="model">project.project</field>
        <field name="inherit_id" ref="project.edit_project"/>
        <field name="arch" type="xml">
            <!-- hide origional fields -->
            <xpath expr="//header" position="inside">
              <field name="is_helpdesk_team" invisible="1"/>
            </xpath>

            <xpath expr="//header/button" position="attributes">
                <attribute name="attrs">{'invisible':[('is_helpdesk_team','=',True)]}</attribute>
            </xpath>
            <xpath expr="//div[hasclass('oe_chatter')]" position="attributes">
                <attribute name="attrs">{'invisible':[('is_helpdesk_team','=',True)]}</attribute>
            </xpath>
            
            <xpath expr="//div[hasclass('oe_title')]" position="replace">
                <div class="oe_title" attrs="{'invisible': [('is_helpdesk_team','=',True)]}" >
                    <h1 class="d-flex flex-row">
                        <field name="is_favorite" nolabel="1" widget="boolean_favorite" class="me-2"/>
                        <field name="name" options="{'line_breaks': False}" widget="text" class="o_text_overflow" placeholder="e.g. Office Party"/>
                    </h1>
                </div>
                <div class="oe_title" attrs="{'invisible': [('is_helpdesk_team','!=',True)]}">
                    <label for="name" string="Name"/>
                    <h1 id="name"><field name="name" options="{'line_breaks': False}" widget="text" placeholder="e.g. Customer Care"/></h1>
                </div>
                <field name="description" 
                    attrs="{'invisible': [('is_helpdesk_team','!=',True)]}"
                    placeholder="Describe your team to your colleagues and customers..."
                    options="{'escape': True}"
                    style="min-height:50px !important;height:50px !important;"
                />
                <field name="company_id" 
                    attrs="{'invisible': [('is_helpdesk_team','!=',True)]}"
                    groups="base.group_multi_company" 
                    required="1" 
                    nolabel="1" 
                    context="{'create': False}"
                />
            </xpath>
              
            <xpath expr="//group[1]" position="attributes">
                <attribute name="attrs">{'invisible':[('is_helpdesk_team','=',True)]}</attribute>
            </xpath>
            <xpath expr="//page[@name='settings']" position="attributes">
                <attribute name="attrs">{'invisible':[('is_helpdesk_team','=',True)]}</attribute>
            </xpath>
            <xpath expr="//page[@name='description']" position="attributes">
               <attribute name="attrs">{'invisible':[('is_helpdesk_team','=',True)]}</attribute>
            </xpath>

            <xpath expr="//button[@name='project_update_all_action']" position="attributes">
                <attribute name="attrs">{'invisible':[('is_helpdesk_team','=',True)]}</attribute>
            </xpath>
            <xpath expr="//div[hasclass('oe_button_box')]//button[2]" position="attributes">
                <attribute name="attrs">{'invisible':[('is_helpdesk_team','=',True)]}</attribute>
            </xpath>
            <xpath expr="//button[3]" position="attributes">
                <attribute name="attrs">{'invisible':[('is_helpdesk_team','=',True)]}</attribute>
            </xpath>
            
            <!-- Add helpdesk sections -->
            <xpath expr="//div[hasclass('oe_button_box')]/button[1]" position="before">
                    <button name="action_open_tickets_view" 
                        type="object" 
                        icon="fa-life-ring" 
                        class="oe_stat_button"
                        attrs="{'invisible':[('is_helpdesk_team','!=',True)]}"
                    >
                            <field string="Tickets" name="task_count" widget="statinfo"/>
                    </button>
                        <field name="count_tickets_rating" invisible="1"/>
                        <field name="tickets_avg_rating" invisible="1"/>
                        <button name="action_open_tickets_rating_view" type="object" class="oe_stat_button" 
                            icon="" attrs="{'invisible': ['|',('allow_customer_rating','!=',True),('count_tickets_rating','=',0)]}"
                            title="Average Rating">
                            <i class="fa fa-fw o_button_icon fa-smile-o text-success" 
                                attrs="{'invisible':[('tickets_avg_rating','&lt;',3.66)]}" title="Satisfied"/>
                            <i class="fa fa-fw o_button_icon fa-meh-o text-warning" 
                                attrs="{'invisible': ['|',('tickets_avg_rating','&lt;',2.33),('tickets_avg_rating','&gt;=', 3.66)]}" title="Okay"/>
                            <i class="fa fa-fw o_button_icon fa-frown-o text-danger" attrs="{'invisible':[('tickets_avg_rating','&gt;=',2.33)]}" title="Dissatisfied"/>
                            <div class="o_field_widget o_stat_info">
                                <span class="o_stat_value">
                                    <field name="tickets_avg_rating" nolabel="1" widget="float" digits="[1, 1]"/> / 5 for <field name="count_tickets_rating" />
                                </span>
                                <span class="o_stat_text">
                                    Avg. Rating
                                </span>
                            </div>
                        </button>
                        <button name="action_open_tickets_sla_view" type="object" icon="fa-calendar-check-o" class="oe_stat_button" attrs="{'invisible': [('is_sla','!=',True)]}">
                            <field name="count_sla" string="SLA Policies" widget="statinfo"/>
                        </button>
            </xpath>
            <xpath expr="//group[1]" position="after">
            <t attrs="{'invisible': [('is_helpdesk_team','!=',True)]}">
                <h2>Visibility &amp; Assignment </h2>
                    <div class="row mt16 o_settings_container" id="productivity">
                        <setting
                            help="People to whom this team and its tickets will be visible"
                        >
                            <field name="privacy_visibility" class="mt16 o_light_label" widget="radio"/>
                            <div>
                                <span class="text-muted o_row ps-1" attrs="{'invisible': [('access_instruction_message','=','')]}">
                                    <i class="fa fa-lightbulb-o"/>&amp;nbsp;<field class="align-top d-inline ms-2" name="access_instruction_message" nolabel="1"/>
                                </span>
                            </div>
                            <div>
                                <span class="text-muted o_row ps-1" attrs="{'invisible': [('privacy_visibility_warning','=', '')]}">
                                    <i class="fa fa-warning"/>&amp;nbsp;<field class="align-top d-inline ms-2" name="privacy_visibility_warning" nolabel="1"/>
                                </span>
                            </div>
                        </setting>
                        <div class="col-lg-6">
                            <setting class="col-lg-12">
                                <label for="message_partner_ids"/>
                                <div class="text-muted">
                                    Receive notifications whenever tickets are created, rated or discussed on in this team
                                </div>
                                <div class="mt16">
                                    <span><b>Followers </b></span>
                                    <field name="message_partner_ids" string="Follow All Team's Tickets" widget="many2many_tags_email"/>
                                </div>
                            </setting>
                            <setting class="col-lg-12" 
                                help="Automate the assignment of new tickets to the right people, and make sure all tickets are being handled"
                                documentation="https://www.dynexcel.co/helpdesk-doc#user-assignment"
                                >
                                <field name="auto_assignment"/>
                                <div attrs="{'invisible': [('auto_assignment','!=',True)]}" class="mt16">
                                    <field name="assign_method" class="o_light_label w-100" widget="radio"/>
                                    <field name="team_member_ids" 
                                        options="{'no_create':True,'no_edit':True}"
                                        widget="many2many_tags"
                                        attrs="{'invisible': [('auto_assignment','!=',True)]}"
                                    />
                                    <div class="mt16">
                                       
                                    </div>
                                </div>
                            </setting>
                        </div>
                    </div>
                    <h2>Automation</h2>
                    <div class="row mt16 o_settings_container" id="automation">
                        <div class="col-lg-6">
                            <setting class="col-lg-12" 
                                help="Set approval for tickets: By security groups (pre-defined teams) or by individual Users."
                                documentation="https://www.dynexcel.co/helpdesk-doc#approvals"
                                >
                                <field name="is_ticket_approvals"/>
                                <div attrs="{'invisible': [('is_ticket_approvals','!=',True)]}" class="mt16">
                                    <field name="ticket_approval_type" 
                                        attrs="{'required':[('is_ticket_approvals','=',True)]}"
                                        class="o_light_label w-100" 
                                        widget="radio"
                                    />
                                </div>
                            </setting>
                            <setting class="col-lg-12" 
                                help="Allow users to combine related tickets into one for a more streamlined resolution."
                                documentation="https://www.dynexcel.co/helpdesk-doc#merge-tickets"
                                >
                                <field name="is_merge_tickets"/>
                            </setting>
                            <setting class="col-lg-12" 
                                documentation="https://www.dynexcel.co/helpdesk-doc#ticket-history"
                                help="Allow users to reopen tickets for a more streamlined resolution.">
                                <field name="is_history_tickets"/>
                            </setting>
                        </div>
                        <div class="col-lg-6">
                            <setting 
                                help="Close inactive tickets automatically"
                                documentation="https://www.dynexcel.co/helpdesk-doc#ticket-close-auto"
                            >
                                <field name="allow_ticket_auto_close"/>
                                <div class="content-group" attrs="{'invisible': [('allow_ticket_auto_close','!=',True)]}" >
                                    <div class="mt16">
                                        <label for="close_stage_id"/>
                                        <field name="close_stage_id" class="ms-2 oe_inline" attrs="{'required': [('allow_ticket_auto_close','=',True)]}" context="{'default_project_id': id}"/>
                                    </div>
                                    <div class="mt8">
                                        <strong>After</strong><field name="day_to_close" class="mx-2 oe_inline text-center" required="1"/><span>days of inactivity</span>
                                    </div>
                                    <div class="mt8">
                                        <label for="from_stage_ids"/>
                                        <field name="from_stage_ids" widget="many2many_tags" class="ms-2" context="{'default_project_id': id}"/>
                                    </div>
                                </div>
                            </setting>
                            <setting class="col-lg-12" 
                                documentation="https://www.dynexcel.co/helpdesk-doc#reopen-tickets"
                                help="Allow users to reopen tickets for a more streamlined resolution.">
                                <field name="is_reopen_tickets"/>
                            </setting>
                            
                        </div>
                        
                    </div>
                    <h2>Channels</h2>
                    <div class="row mt16 o_settings_container" id="channels">
                        <setting id="alias_channels" help="Create tickets by sending an email to an alias"
                            documentation="https://www.dynexcel.co/helpdesk-doc#receive-tickets">
                            <div class="mt16">
                                <div class="oe_edit_only">
                                    <div class="text-muted">
                                       Create tickets by sending an email to an alias
                                    </div>
                                    <strong>Alias </strong>
                                    <field name="alias_name" class="w-25"/>@
                                    <field name="alias_domain" class="oe_inline" placeholder="e.g. domain.com"
                                           options="{'no_create': True, 'no_open': True}"/>

                                    <p attrs="{'invisible':[('alias_domain','=',True)]}">
                                        <button name="%(base_setup.action_general_configuration)d" type="action" string="Set an Alias Domain" icon="oi-arrow-right" class="btn-link mt-2"/>
                                    </p>
                                </div>
                            </div>
                        </setting>
                        <setting>
                        </setting>
                    </div>
                    <h2>Help Center</h2>
                    <div class="row mt16 o_settings_container" id="website_form_channel">
                        <setting help="Get tickets through an online form">
                            <field name="allow_submit_ticket_from_web"/>
                        </setting>
                        <setting>
                        </setting>
                    </div>

                    <h2>Track Bill and Time</h2>
                    <div class="row mt16 o_settings_container" id="website_form_channel">
                        <div class="row mt16 o_settings_container">
                            <setting id="hr_timesheet"
                                     help="Track the employee time spent on tickets"
                                     documentation="https://www.dynexcel.co/helpdesk-doc#track-time">
                                <field name="module_hr_timesheet"/>
                            </setting>
                            <setting id="sale_timesheet"
                                     help="Bill the time spent on your tickets to your customers"
                                     documentation="https://www.dynexcel.co/helpdesk-doc#bill-time">
                                <field name="module_sale_timesheet"/>
                            </setting>
                        </div>
                    </div>

                    <h2>SLA Policies</h2>
                    <div class="row mt16 o_settings_container" id="website_form_channel">
                        <setting id="sla"
                                  help="Make sure tickets are handled on time"
                                  documentation="https://www.dynexcel.co/helpdesk-doc#sla-policy">
                            <field name="is_sla"/>
                            <div class="mt16" attrs="{'invisible': [('is_sla','!=',True)]}" >
                                <label for="resource_calendar_id"/>
                                <field name="resource_calendar_id" attrs="{'required':[('is_sla','=',True)]}"/>
                            </div>
                        </setting>
                        <setting id="rating" help="Track customer satisfaction on tickets"
                            documentation="https://www.dynexcel.co/helpdesk-doc#customer-rating">
                            <field name="allow_customer_rating"/>
                            <div id="allow_customer_rating" attrs="{'invisible': [('allow_customer_rating','!=',True)]}" >
                                <field name="publish_rating" class="oe_inline"/>
                                <label for="publish_rating" string="Publish this team's ratings on your website"/>
                                
                            </div>
                        </setting>
                        <setting id="rating" help="Set an Email Template on Stages">
                            <div class="text-muted">
                                Set an Email Template on Stages
                            </div>
                            <div class="mt-3">
                                <button name="%(action_ticket_stage)d" type="action" string="Set an Email Template on Stages" icon="oi-arrow-right" class="btn-link" context="{'search_default_team_ids': name}"/>
                            </div>
                        </setting>
                    </div>

                    <h2>Self Service</h2>
                    <div class="row mt16 o_settings_container" id="website_form_channel">
                        <setting help="Allow customers to easily close their tickets through the portal for quick resolutions." documentation="https://www.dynexcel.co/helpdesk-doc#portal-ticket-close">
                            <field name="allow_portal_user_close_ticket"/>
                            <div class="mt16">
                                        <label for="portal_close_stage_id"/>
                                        <field name="portal_close_stage_id" 
                                            class="ms-2 oe_inline" 
                                            attrs="{'required': [('allow_portal_user_close_ticket','=',True)],'invisible':[('allow_portal_user_close_ticket','!=',True)]}" 
                                            context="{'default_project_id': id}"
                                            
                                        />
                                    </div>
                        </setting>
                        
                        <setting help="Allow customers to conveniently reopen their tickets through the portal for further assistance." documentation="https://www.dynexcel.co/helpdesk-doc#portal-ticket-reopen">
                            <field name="allow_portal_user_reopen_ticket"/>
                        </setting>
                    </div>
            </t>
            </xpath>
        </field>
      </record>

      
      <record id="helpdesk_team_search_view" model="ir.ui.view">
        <field name="name">helpdesk.team.search.view</field>
        <field name="model">project.project</field>
        <field name="arch" type="xml">
            <search string="Helpdesk Team Search">
                <field name="name"/>
                <field name="company_id" groups="base.group_multi_company"/>
                <separator/>
                <filter string="Archived" domain="[('active', '=', False)]" name="archived"/>
                <group expand="0" string="Group By">
                    <filter string="Company" name="company" context="{'group_by': 'company_id'}" groups="base.group_multi_company"/>
                </group>
            </search>
        </field>
    </record>
      
      
    <record id="helpdesk_team_tree_view" model="ir.ui.view">
        <field name="name">helpdesk.team.tree.view</field>
        <field name="model">project.project</field>
        <field name="arch" type="xml">
            <tree string="Helpdesk Team" multi_edit="1" sample="1">
                <field name="sequence" widget="handle"/>
                <field name="name" class="field_name" string="Name"/>
                <field name="alias_value" string="Email Alias" widget="email" readonly="1" />
                <field name="company_id" groups="base.group_multi_company" readonly="1" context="{'create': False}"/>
            </tree>
        </field>
    </record>

      <record id="open_view_project_helpdesk_config" model="ir.actions.act_window">
            <field name="name">Projects</field>
            <field name="res_model">project.project</field>
            <field name="domain">[]</field>
            <field name="view_mode">tree,kanban,form</field>
            <field name="view_ids" eval="[(5, 0, 0),
                (0, 0, {'view_mode': 'tree', 'view_id': ref('helpdesk_team_tree_view')}),
                (0, 0, {'view_mode': 'kanban', 'view_id': ref('project.view_project_config_kanban')})]"/>
            <field name="search_view_id" ref="helpdesk_team_search_view"/>
            <field name="domain">[
                ('is_helpdesk_team', '=', True),
                ]
            </field>
            <field name="context">{
                'default_is_helpdesk_team': True
                }
            </field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                   No projects found. Let's create one!
                </p>
                <p>
                    Create projects to organize your tasks and define a different workflow for each project.
                </p>
            </field>
        </record>
      
    <menuitem name="Helpdesk Teams" id="menu_helpdesk_config_teams"
            parent="menu_helpdesk_config" 
            action="open_view_project_helpdesk_config"
            sequence="20"
        />
  </data>
</odoo>
